# Sample configuration for serving AST_L1T.

# START MODULE CONFIG (NOT NECESSARY IF LOADED ELSEWHWERE)
# Load necessary Apache modules
<IfModule !proxy_module>
    LoadModule proxy_module modules/mod_proxy.so
</IfModule>

# Serves MRFs from local disk or remote source
<IfModule !mrf_module>
   LoadModule mrf_module modules/mod_mrf.so
</IfModule>

# Serves MRFs from local disk or remote source
<IfModule !reproject_module>
   LoadModule reproject_module modules/mod_reproject.so
</IfModule>

# Handles error messages and WMTS protocol stuff for mod_mrf and mod_reproject
<IfModule !wmts_wrapper_module>
        LoadModule wmts_wrapper_module modules/mod_wmts_wrapper.so
</IfModule>

# Module used internally by all the other OE2 modules
<IfModule !receive_module>
        LoadModule receive_module modules/mod_receive.so
</IfModule>

# Module for TWMS support
<IfModule !twms_module>
    LoadModule twms_module modules/mod_twms.so
</IfModule>

# END MODULE CONFIG

# Configure gibs-status rewrite rule
<IfModule !rewrite_module>
    LoadModule rewrite_module modules/mod_rewrite.so
</IfModule>
RewriteEngine On
RewriteRule    ^/gibs-status/?$    http://localhost/wmts/epsg3857/all/wmts.cgi?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD&STYLE=&TILEMATRIXSET=GoogleMapsCompatible_Level13&TILEMATRIX=2&TILEROW=1&TILECOL=3&FORMAT=image/png&TIME=1970-01-01T00:00:00Z    [NC,P]

# START S3 PROXY SETUP
# Proxy setup: if using MRF data files located on a remote server (i.e. S3), that server needs to be proxied to a local
# path for mod_mrf to access it, i.e.:
# ProxyPass {local_endpoint} {full path of remote endpoint}
SSLProxyEngine on
ProxyPass /s3 {S3_URL}
ProxyPassReverse /s3 {S3_URL}
# ProxyPass /s3 http://gitc-test-imagery.s3.amazonaws.com
# ProxyPassReverse /s3 http://gitc-test-imagery.s3.amazonaws.com
# END S3 PROXY SETUP

# START DATE SERVICE PROXY SETUP 
SSLProxyEngine on
ProxyPass /date_service http://oe2-date-service
ProxyPassReverse /date_service http://oe2-date-service
# END DATE SERVICE PROXY SETUP 

# EPSG:4326

<Directory /var/www/html/wmts/epsg4326/all>
        WMTSWrapperRole root
</Directory>

<Directory /var/www/html/wmts/epsg4326/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg4326/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg4326/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default/15.625m>
        MRF On
        MRF_ConfigurationFile /var/www/html/wmts/epsg4326/configs/ASTER_L1T_Radiance_Terrain_Corrected.config
        MRF_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily
        WMTSWrapperRole tilematrixset
        WMTSWrapperEnableYearDir On
        WMTSWrapperLayerAlias ASTER_L1T_Radiance_Terrain_Corrected
</Directory>

<Directory /var/www/html/wmts/epsg4326/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg4326/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg4326/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default/15.625m>
        MRF On
        MRF_ConfigurationFile /var/www/html/wmts/epsg4326/configs/ASTER_L1T_Radiance_Terrain_Corrected.config
        MRF_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD
        WMTSWrapperRole tilematrixset
        WMTSWrapperEnableYearDir On
        WMTSWrapperLayerAlias ASTER_L1T_Radiance_Terrain_Corrected
</Directory>

<Directory /var/www/html/wmts/epsg4326/best>
        WMTSWrapperRole root
</Directory>

<Directory /var/www/html/wmts/epsg4326/best/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg4326/best/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg4326/best/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default/15.625m>
        MRF On
        MRF_ConfigurationFile /var/www/html/wmts/epsg4326/configs/ASTER_L1T_Radiance_Terrain_Corrected.config
        MRF_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily
        WMTSWrapperRole tilematrixset
        WMTSWrapperEnableYearDir On
        WMTSWrapperLayerAlias ASTER_L1T_Radiance_Terrain_Corrected
</Directory>

<Directory /var/www/html/wmts/epsg4326/std>
        WMTSWrapperRole root
</Directory>

<Directory /var/www/html/wmts/epsg4326/std/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg4326/std/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg4326/std/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default/15.625m>
        MRF On
        MRF_ConfigurationFile /var/www/html/wmts/epsg4326/configs/ASTER_L1T_Radiance_Terrain_Corrected.config
        MRF_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD
        WMTSWrapperRole tilematrixset
        WMTSWrapperEnableYearDir On
        WMTSWrapperLayerAlias ASTER_L1T_Radiance_Terrain_Corrected
</Directory>

# EPSG:3857 reproject

<Directory /var/www/html/wmts/epsg3857/all>
        WMTSWrapperRole root
</Directory>

<Directory /var/www/html/wmts/epsg3857/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg3857/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg3857/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default/GoogleMapsCompatible_Level13>
        Reproject_ConfigurationFiles /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_source.config /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_reproject.config
        Reproject_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily
        WMTSWrapperRole tilematrixset
</Directory>

<Directory /var/www/html/wmts/epsg3857/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg3857/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg3857/all/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default/GoogleMapsCompatible_Level13>
        Reproject_ConfigurationFiles /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_source.config /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_reproject.config
        Reproject_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD
        WMTSWrapperRole tilematrixset
</Directory>

<Directory /var/www/html/wmts/epsg3857/best>
        WMTSWrapperRole root
</Directory>

<Directory /var/www/html/wmts/epsg3857/best/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg3857/best/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg3857/best/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily/default/GoogleMapsCompatible_Level13>
        Reproject_ConfigurationFiles /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_source.config /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_reproject.config
        Reproject_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily
        WMTSWrapperRole tilematrixset
</Directory>

<Directory /var/www/html/wmts/epsg3857/std>
        WMTSWrapperRole root
</Directory>

<Directory /var/www/html/wmts/epsg3857/std/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD>
        WMTSWrapperRole layer
</Directory>

<Directory /var/www/html/wmts/epsg3857/std/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default>
        WMTSWrapperRole style
        WMTSWrapperEnableTime On
        WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /var/www/html/wmts/epsg3857/std/ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD/default/GoogleMapsCompatible_Level13>
        Reproject_ConfigurationFiles /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_source.config /var/www/html/wmts/epsg3857/configs/ASTER_L1T_Radiance_Terrain_Corrected_reproject.config
        Reproject_RegExp ASTER_L1T_Radiance_Terrain_Corrected_Subdaily_v3_STD
        WMTSWrapperRole tilematrixset
</Directory>

# TWMS Configs

<Directory /var/www/html/twms/epsg4326/all/>
        tWMS_RegExp twms.cgi
        tWMS_ConfigurationFile /var/www/html/twms/epsg4326/configs/${layer}/twms.config
</Directory>

<Directory /var/www/html/twms/epsg4326/best/>
        tWMS_RegExp twms.cgi
        tWMS_ConfigurationFile /var/www/html/twms/epsg4326/configs/${layer}/twms.config
</Directory>

<Directory /var/www/html/twms/epsg4326/std/>
        tWMS_RegExp twms.cgi
        tWMS_ConfigurationFile /var/www/html/twms/epsg4326/configs/${layer}/twms.config
</Directory>

<Directory /var/www/html/twms/epsg3857/all/>
        tWMS_RegExp twms.cgi
        tWMS_ConfigurationFile /var/www/html/twms/epsg3857/configs/${layer}/twms.config
</Directory>

<Directory /var/www/html/twms/epsg3857/best/>
        tWMS_RegExp twms.cgi
        tWMS_ConfigurationFile /var/www/html/twms/epsg3857/configs/${layer}/twms.config
</Directory>

<Directory /var/www/html/twms/epsg3857/std/>
        tWMS_RegExp twms.cgi
        tWMS_ConfigurationFile /var/www/html/twms/epsg3857/configs/${layer}/twms.config
</Directory>

# END LAYER CONFIG BLOCK