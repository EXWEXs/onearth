# START MODULE CONFIG (NOT NECESSARY IF LOADED ELSEWHWERE)
# Load necessary Apache modules
<IfModule !proxy_module>
   LoadModule proxy_module modules/mod_proxy.so
</IfModule>

# Serves MRFs from local disk or remote source
<IfModule !mrf_module>
   LoadModule mrf_module modules/mod_mrf.so
</IfModule>

# Handles error messages and WMTS protocol stuff for mod_mrf and mod_reproject
<IfModule !wmts_wrapper_module>
   LoadModule wmts_wrapper_module modules/mod_wmts_wrapper.so
</IfModule>

# Module used internally by all the other OE2 modules
<IfModule !receive_module>
   LoadModule receive_module modules/mod_receive.so
</IfModule>

<IfModule !sfim_module>
   LoadModule sfim_module modules/mod_sfim.so
</IfModule>

# END MODULE CONFIG

# START S3 PROXY SETUP
# Proxy setup: if using MRF data files located on a remote server (i.e. S3), that server needs to be proxied to a local
# path for mod_mrf to access it, i.e.:
# ProxyPass {local_endpoint} {full path of remote endpoint}
SSLProxyEngine on
ProxyPass /s3 http://gitc-test-imagery.s3.amazonaws.com
ProxyPassReverse /s3 http://gitc-test-imagery.s3.amazonaws.com
# END S3 PROXY SETUP

# START DATE SERVICE PROXY SETUP 
#SSLProxyEngine on
#ProxyPass /date_service http://oe2-date-service
#ProxyPassReverse /date_service http://oe2-date-service
# END DATE SERVICE PROXY SETUP 

# START ENDPOINT SETUP
# NOTE THAT ALL DIRECTORIES BELOW NEED TO ACTUALLY EXIST ON THE FILESYSTEM AND BE ACCESSIBLE TO APACHE
# Start by configuring the endpoint from which all the tiles will be served.
<Directory /build/test/ci_tests/mrf_endpoint>
   WMTSWrapperRole root
   SendFileIfMatch /build/test/ci_tests/mrf_endpoint/getCapabilities.xml GetCapabilities text/xml
</Directory>
# END ENDPOINT SETUP

# One of these blocks needs to exist for each layer that's configured. This uses "date_test" as the layer name
# START LAYER CONFIG BLOCK
#<Directory /build/test/ci_tests/mrf_endpoint/date_test>
#   WMTSWrapperRole layer
#</Directory>

# If the time service is configured, uncomment the two lines in this section.
# The Uri needs to point to wherever the local time service is running
#<Directory /build/test/ci_tests/mrf_endpoint/date_test/default>
#   WMTSWrapperRole style
#   WMTSWrapperEnableTime On
#   WMTSWrapperTimeLookupUri "/date_service/date"
#</Directory>

#<Directory /build/test/ci_tests/mrf_endpoint/date_test/default/tms>
#   MRF On
   # The next line needs to point to an additional, per-layer config file that's accessible to Apache
#   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/date_test/default/tms/test_mod_mrf_date_layer.config
#   MRF_RegExp date_test
#   WMTSWrapperRole tilematrixset
#</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_daily_png>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_daily_png/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_daily_png/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/test_daily_png/default/EPSG4326_16km/test_mod_mrf_daily_png.config
   # If we want to use this as a static layer for testing
   # MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/VNGCR_LQD_I1-M4-M3_NRT/default/250m/VNGCR_LQD_I1-M4-M3_NRT_STATIC.config
   MRF_RegExp test_daily_png
   WMTSWrapperRole tilematrixset
   WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_legacy_subdaily_jpg>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_legacy_subdaily_jpg/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_legacy_subdaily_jpg/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/test_legacy_subdaily_jpg/default/EPSG4326_16km/test_mod_mrf_legacy_subdaily_jpg.config
   MRF_RegExp test_legacy_subdaily_jpg
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_nonyear_jpg>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_nonyear_jpg/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_nonyear_jpg/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/test_nonyear_jpg/default/EPSG4326_16km/test_mod_mrf_nonyear_jpg.config
   MRF_RegExp test_nonyear_jpg
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_static_jpg>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_static_jpg/default>
   WMTSWrapperRole style
   #WMTSWrapperEnableTime On
   #WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_static_jpg/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/test_static_jpg/default/EPSG4326_16km/test_mod_mrf_static_jpg.config
   MRF_RegExp test_static_jpg
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_weekly_jpg>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_weekly_jpg/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/test_weekly_jpg/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/test_weekly_jpg/default/EPSG4326_16km/test_mod_mrf_weekly_jpg.config
   MRF_RegExp test_weekly_jpg
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_1a>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_1a/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_1a/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_1a/default/EPSG4326_16km/test_mod_mrf_snap_1a.config
   MRF_RegExp snap_test_1a
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_2a>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_2a/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_2a/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_2a/default/EPSG4326_16km/test_mod_mrf_snap_2a.config
   MRF_RegExp snap_test_2a
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3a>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3a/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3a/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_3a/default/EPSG4326_16km/test_mod_mrf_snap_3a.config
   MRF_RegExp snap_test_3a
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3b>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3b/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3b/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_3b/default/EPSG4326_16km/test_mod_mrf_snap_3b.config
   MRF_RegExp snap_test_3b
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3c>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3c/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3c/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_3c/default/EPSG4326_16km/test_mod_mrf_snap_3c.config
   MRF_RegExp snap_test_3c
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3d>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3d/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_3d/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_3d/default/EPSG4326_16km/test_mod_mrf_snap_3d.config
   MRF_RegExp snap_test_3d
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4a>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4a/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4a/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_4a/default/EPSG4326_16km/test_mod_mrf_snap_4a.config
   MRF_RegExp snap_test_4a
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4b>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4b/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4b/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_4b/default/EPSG4326_16km/test_mod_mrf_snap_4b.config
   MRF_RegExp snap_test_4b
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4c>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4c/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_4c/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_4c/default/EPSG4326_16km/test_mod_mrf_snap_4c.config
   MRF_RegExp snap_test_4c
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_5a>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_5a/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_5a/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_5a/default/EPSG4326_16km/test_mod_mrf_snap_5a.config
   MRF_RegExp snap_test_5a
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_year_boundary>
   WMTSWrapperRole layer
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_year_boundary/default>
   WMTSWrapperRole style
   WMTSWrapperEnableTime On
   WMTSWrapperTimeLookupUri "/date_service/date"
</Directory>

<Directory /build/test/ci_tests/mrf_endpoint/snap_test_year_boundary/default/EPSG4326_16km>
   MRF On
   MRF_ConfigurationFile /build/test/ci_tests/mrf_endpoint/snap_test_year_boundary/default/EPSG4326_16km/test_mod_mrf_snap_year_boundary.config
   MRF_RegExp snap_test_year_boundary
   WMTSWrapperRole tilematrixset
   #WMTSWrapperEnableYearDir On
</Directory>

# END LAYER CONFIG BLOCK

